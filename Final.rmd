---
title: "Covid91 vaccine study Final2022"
author: "Madeleine Alseryani"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="final_Data.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
#FinalData$infected <- relevel(FinalData$infected,ref="OK")
male = filter(FinalData, sex =="M")
female = filter(FinalData, sex =="F")
gay = filter(FinalData, LGBTQ =="gay")
Druguser = filter(FinalData, DrugUser =="yes")
```

# Introduction

A new  preventative vaccine (covid91) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.


## Males


#### Plot barplots ggplot way

```{r}
dd2 <- male %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This bar plot represents the population of males and the relationship of the contraction of covid-19 by either taking a placebo or the vaccine.

The bar plot depicts that about roughly 26% of the male population that took the vaccine got covid-19 whereas, about 68% of the males that took the placebo got covid-19. For the people who got covid, if we compare who took the placebo and who took the vaccine, we can see that the difference is about half. A substantially higher percentage of people who took the placebo contracted covid-19 versus those who got the vaccine itself. This indicates that the
vaccine appears to be pretty effective for the male population that took it. Hence, the vaccine worked for the male population.

We are given two different plots to look at that share the same data. Looking at the first plot, the x-axis represents the individuals that were contacted with covid-19 or those that were not. The y-axis represents the count, which is the number of people that got covid-19 or not. In the second plot, the left two bars of the graph are all the people that got covid-19. The x-axis represents whether a person got covid-19 or not. The y-axis now represents the percentage of people that got covid-19 after taking the the placebo or taking the Vaccine. 


### Numerical results for males

```{r}
table1 <- xtabs(~infected + treatment, data=male)
rowPerc(table1)
colPerc(table1)
```

The numerical results above show the percentages of the male population that contracted covid-19 after taking the placebo and the vaccine. About 68% of males got covid-19 after taking the placebo and 32% got covid-19 after taking the vaccine. The vaccine is clearly effective here in preventing covid-19 among males. Those who took the vaccine were much less likely to get covid-19. The odds of getting covid-19 while taking the vaccine is 2:1.

### Inferential results for males


```{r}
chisq.test(table1)
chisqtestGC(table1)
malefish <- fisher.test(table1)
malefish
```

After running the Fisher's exact test, we always want to look at the given P-value. We acquired a P-value of 2.645e-11. This is a super small number which indicates that there is a significant difference and that these results are not likely or commonly to occur by chance. 

The odds ratio above depicts a ratio of 2.09. Therefore the males that recieved the vaccine were less likely to contact the virus than those who received the placebo.

```{r}
effect <- malefish$p.value/(malefish$p.value +1)
effectivenessmale = malefish$estimate/(malefish$estimate +1)*100
print(effectivenessmale)
```

```{r}
low=(malefish$conf.int[1]/(malefish$conf.int[1] +1))*100
hi=(malefish$conf.int[2]/(malefish$conf.int[2] +1))*100
options(digits=2)
```

## Effectiveness Confidence Interval `r low`  to `r hi`

Above is the effectiveness for the covid-19 vaccine among the male population. If the effectiveness is above 50% that means that the vaccine is effective. Based on the interval seen above, we can easily conclude that the vaccine is effective in preventing males from contacting covid-19. 

The odds ratio is approximately how effective the vaccine is. In order for the vaccine to be effective, we said that we would need the value to be atleast 50 or higher. The odds ratio for the guys can be seen above as 67.6. The effectiveness confidence interval for the males is 62.51 to 72.51. Based on the interval above, we can conclude that the vaccine is highly effective for the male population.

## Females

#### Plot barplots ggplot way

```{r}
dd2 <- female %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

## LGBTQ



## Druggies

